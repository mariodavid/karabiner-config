(function(n,K){typeof exports=="object"&&typeof module<"u"?K(exports):typeof define=="function"&&define.amd?define(["exports"],K):(n=typeof globalThis<"u"?globalThis:n||self,K((n.karabiner=n.karabiner||{},n.karabiner.ts={})))})(this,function(n){"use strict";const K=["left_control","left_shift","left_option","left_command","right_control","right_shift","right_option","right_command","fn"],ae=[...K,"caps_lock"],le=["return_or_enter","escape","delete_or_backspace","delete_forward","tab","spacebar","hyphen","equal_sign","open_bracket","close_bracket","backslash","non_us_pound","semicolon","quote","grave_accent_and_tilde","comma","period","slash","non_us_backslash"],ue=["up_arrow","down_arrow","left_arrow","right_arrow","page_up","page_down","home","end"],ce=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],de=["1","2","3","4","5","6","7","8","9","0"],fe=["f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","f13","f14","f15","f16","f17","f18","f19","f20"],_e=["keypad_num_lock","keypad_slash","keypad_asterisk","keypad_hyphen","keypad_plus","keypad_enter","keypad_1","keypad_2","keypad_3","keypad_4","keypad_5","keypad_6","keypad_7","keypad_8","keypad_9","keypad_0","keypad_period","keypad_equal_sign","keypad_comma"],he=["print_screen","scroll_lock","pause","insert","application","help","power"],pe=["international1","international3","lang1","lang2"],me=["japanese_eisuu","japanese_kana"],ye=["volume_down","volume_up","mute","volume_decrement","volume_increment"],q=["f21","f22","f23","f24","execute","menu","select","stop","again","undo","cut","copy","paste","find","international2","international4","international5","international6","international7","international8","international9","lang3","lang4","lang5","lang6","lang7","lang8","lang9","japanese_pc_nfer","japanese_pc_xfer","japanese_pc_katakana","keypad_equal_sign_as400","locking_caps_lock","locking_num_lock","locking_scroll_lock","alternate_erase","sys_req_or_attention","cancel","clear","prior","return","separator","out","oper","clear_or_again","cr_sel_or_props","ex_sel"],O=["vk_none","vk_consumer_brightness_down","vk_consumer_brightness_up","vk_mission_control","vk_launchpad","vk_dashboard","vk_consumer_illumination_down","vk_consumer_illumination_up","vk_consumer_previous","vk_consumer_play","vk_consumer_next","display_brightness_decrement","display_brightness_increment","rewind","play_or_pause","fastforward","apple_display_brightness_decrement","apple_display_brightness_increment","dashboard","launchpad","mission_control","apple_top_case_display_brightness_decrement","apple_top_case_display_brightness_increment","illumination_decrement","illumination_increment"],Ye=["rewind","play_or_pause","fast_forward","mute","volume_decrement","volume_increment","al_terminal_lock_or_screensaver","eject","scan_previous_track","scan_next_track","al_word_processor","al_text_editor","al_spreadsheet","al_presentation_app","al_email_reader","al_calculator","al_local_machine_browser","al_internet_browser","al_dictionary","fastforward"],Ze=["menu","al_graphics_editor","al_database_app","al_newsreader","al_voicemail","al_contacts_or_address_book","al_Calendar_Or_Schedule","al_task_or_project_manager","al_log_or_journal_or_timecard","al_checkbook_or_finance","al_a_or_v_capture_or_playback","al_lan_or_wan_browser","al_remote_networking_or_isp_connect","al_network_conference","al_network_chat","al_telephony_or_dialer","al_logon","al_logoff","al_logon_or_logoff","al_control_panel","al_command_line_processor_or_run","al_process_or_task_manager","al_select_task_or_application","al_next_task_or_application","al_previous_task_or_application","al_preemptive_halt_task_or_application","al_integrated_help_center","al_documents","al_thesaurus","al_desktop","al_spell_check","al_grammer_check","al_wireless_status","al_keyboard_layout","al_virus_protection","al_encryption","al_screen_saver","al_alarms","al_clock","al_file_browser","al_power_status","al_image_browser","al_audio_browser","al_movie_browser","al_digital_rights_manager","al_digital_wallet","al_instant_messaging","al_oem_feature_browser","al_oem_help","al_online_community","al_entertainment_content_browser","al_online_shopping_browswer","al_smart_card_information_or_help","al_market_monitor_or_finance_browser","al_customized_corporate_news_browser","al_online_activity_browswer","al_research_or_search_browswer","al_audio_player","al_message_status","al_contact_sync","al_navigation","al_contextaware_desktop_assistant","ac_home","ac_back","ac_forward","ac_refresh","ac_bookmarks","menu_pick","menu_up","menu_down","menu_left","menu_right","menu_escape","menu_value_increase","menu_value_decrease","data_on_screen","closed_caption","closed_caption_select","vcr_or_tv","broadcast_mode","snapshot","still","picture_in_picture_toggle","picture_in_picture_swap","red_menu_button","green_menu_button","blue_menu_button","yellow_menu_button","aspect","three_dimensional_mode_select"],xe=["display_brightness_decrement","display_brightness_increment","dictation"],et=["button1","button2","button3","button4","button5","button6","button7","button8","button9","button10","button11","button12","button13","button14","button15","button16","button17","button18","button19","button20","button21","button22","button23","button24","button25","button26","button27","button28","button29","button30","button31","button32"],$={"⌘":"command","⌥":"option","⌃":"control","⇧":"shift","⇪":"caps_lock"},Z={"↑":"up_arrow","↓":"down_arrow","←":"left_arrow","→":"right_arrow","⇞":"page_up","⇟":"page_down","↖︎":"home","↘︎":"end"},x={"⏎":"return_or_enter","⎋":"escape","⌫":"delete_or_backspace","⌦":"delete_forward","⇥":"tab","␣":"spacebar","-":"hyphen","=":"equal_sign","[":"open_bracket","]":"close_bracket","\\":"backslash",";":"semicolon","'":"quote","`":"grave_accent_and_tilde",",":"comma",".":"period","/":"slash"},be={...Z,...x,"⇪":$["⇪"]},tt=[...K,...ae,...le,...ue,...ce,...de,...fe,..._e,...he,...pe,...me,...ye,...q,...O];function A(t,e,i){if(typeof t=="number")return`${t}`;if(t.length>1&&R(t)){const r=W(t);if((r==null?void 0:r.length)===1)return r[0];throw new Error(`Invalid key ${t}`)}if(t in be)return be[t];const o=t;if(!tt.includes(o))throw new Error(`${o} is not valid key_code`);if(e!=null&&e.includes(o))throw new Error(`Key ${t} cannot be used ${i||"here"}`);return o}const ge={Meh:["option","control","shift"],Hyper:["command","option","control","shift"],SuperHyper:["command","option","control","shift","fn"]},ee={"⌘⇧":["command","shift"],"⌥⇧":["option","shift"],"⌃⇧":["control","shift"],"⌘⌥":["command","option"],"⌘⌃":["command","control"],"⌥⌃":["option","control"],"⌘⌥⌃":["command","option","control"],"⌘⌥⇧":["command","option","shift"],"⌘⌃⇧":["command","control","shift"],"⌥⌃⇧":["option","control","shift"],"⌘⌥⌃⇧":["command","option","control","shift"],...ge};function S(t){if(!t)return;if(typeof t=="string")return R(t)?W(t):t in $?[$[t]]:t in ee?ee[t]:[t];if(Array.isArray(t))return ot(t)?nt(t):t.map(rt);let e;"left"in t?e=j("left",t.left):"l"in t&&(e=j("left",t.l));let i;if("right"in t?i=j("right",t.right):"r"in t&&(i=j("right",t.r)),!(!(e!=null&&e.length)&&!(i!=null&&i.length)))return[...e||[],...i||[]]}const ke=/^(left|l|<|‹)([⌘⌥⌃⇧]*)$/,we=/^(right|r|>|›)([⌘⌥⌃⇧]*)$/;function P(t,e){if(!(!t&&!e))return{mandatory:ve(t),optional:ve(e)}}function ve(t){if(t)return t==="any"?["any"]:S(t)}const it=new Set(["command","option","control","shift"]);function R(t){return ke.test(t)||we.test(t)}function W(t){const e=t.match(ke);if(e)return j("left",e[2]);const i=t.match(we);if(i)return j("right",i[2])}function ot(t){return t.some(R)}function nt(t){return t.reduce((e,i)=>[...e,...R(i)?W(i)||[]:S(i)||[]],[])}function j(t,e){var i;if(e)return(i=S(e))==null?void 0:i.map(o=>it.has(o)?`${t}_${o}`:o)}function rt(t){return t in $?$[t]:t}function C(t){return Array.isArray(t)?t:[t]}function k(t,e=1,i){return new w({type:"variable_if",name:t,value:e,description:i})}function st(t,e){var o,r;let i;if(Array.isArray(t))i=t.map(z);else if(typeof t=="string"||t instanceof RegExp)i=[z(t)];else return new w({type:"frontmost_application_if",description:e,file_paths:(o=t.file_paths)==null?void 0:o.map(z),bundle_identifiers:(r=t.bundle_identifiers)==null?void 0:r.map(z)});return new w({type:"frontmost_application_if",description:e,bundle_identifiers:i})}function at(t,e){return new w({type:"device_if",identifiers:C(t),description:e})}function lt(t,e){return new w({type:"device_exists_if",identifiers:C(t),description:e})}function ut(t,e){return new w({type:"keyboard_type_if",keyboard_types:C(t),description:e})}function ct(t,e){return new w({type:"input_source_if",input_sources:C(t),description:e})}function dt(t=!0,e){return new w({type:"event_changed_if",value:t,description:e})}const ft=_t({frontmost_application_if:"frontmost_application_unless",device_if:"device_unless",device_exists_if:"device_exists_unless",keyboard_type_if:"keyboard_type_unless",input_source_if:"input_source_unless",variable_if:"variable_unless",event_changed_if:"event_changed_unless"});class w{constructor(e){this.condition=e}unless(){return new w({...this.condition,type:ft[this.condition.type]})}build(){return{...this.condition}}}function Ce(t){return typeof t.build=="function"}function E(t){return Ce(t)?t.build():t}function z(t){return typeof t=="string"?t:t.toString().slice(1,-1)}function _t(t){return Object.keys(t).reduce((e,i)=>({...e,[e[i]]:i}),t)}const ht=["optionalAny","?any","??"];function pt(t){return!t||typeof t!="string"?!1:ht.includes(t)}function mt(t){return/^\?(left|l|<|‹|right|r|>|›)?([⌘⌥⌃⇧⇪]*)$/.test(t)}function b(t,e){if(!t)return P(t,e);if(pt(t))return P("","any");if(typeof t=="string"){if(mt(t))return P("",S(t.slice(1)));if(t.startsWith("?"))throw new Error(`${t} is not valid optional alias`)}return typeof t=="object"&&"optional"in t?P("",t.optional):P(t,e)}function D(t,e,i){if(typeof t=="object")return new L(t);const o=A(t,O,"for from.key_code");return new L({key_code:o,modifiers:b(e,i)})}function yt(t,e,i){return new L({consumer_key_code:t,modifiers:b(e,i)})}function bt(t,e,i){return new L({pointing_button:t,modifiers:b(e,i)})}function m(t,e,i){const o=A(t,q,"as to.key_code");return{...i,key_code:o,modifiers:e?S(e):void 0}}function Me(t){return m("left_command","⌥⌃⇧",t)}function Ke(t){return m("left_option","⌃⇧",t)}function Ae(t){return m("fn","⌘⌥⌃⇧",t)}function Se(t){return m("vk_none",void 0,t)}function Ee(t,e,i){return{...i,consumer_key_code:t,modifiers:e?S(e):void 0}}function Te(t,e,i){return{...i,pointing_button:t,modifiers:e?S(e):void 0}}function U(t){return{shell_command:t}}function Oe(t){const e=t.match(/^"?(.*?)(.app)?"?$/);return U(`open -a "${(e==null?void 0:e[1])||t}".app`)}function $e(t){return U(`osascript -e '
set prev to the clipboard
set the clipboard to "${t}"
tell application "System Events"
  keystroke "v" using command down
  delay 0.1
end tell
set the clipboard to prev'`)}const Pe=["Tink","Submarine","Sosumi","Morse","Ping","Pop","Purr","Glass","Hero","Frog","Funk","Blow","Bottle","Basso"];function gt(t){const e=Pe.includes(t)?`/System/Library/Sounds/${t}.aiff`:t;return U(`afplay ${e}`)}function je(t){return{select_input_source:t}}function h(t,e=1,i,o){return{set_variable:{name:t,value:e,key_up_value:i,type:o}}}function De(t){return{set_variable:{name:t,type:"unset"}}}function te(t,e){return{set_notification_message:{id:t,text:e}}}function F(t){return{set_notification_message:{id:t,text:""}}}function Ve(t){return{mouse_key:t}}function Le(t,e="toggle"){return{sticky_modifier:{[t]:e}}}function Ne(t){return{software_function:{cg_event_double_click:{button:t}}}}function Be(t){return{software_function:{set_mouse_cursor_position:t}}}function Ie(t){return{software_function:{iokit_power_management_sleep_system:{delay_milliseconds:t}}}}const V={};for(let t=0;t<=9;t++)V[t]=m(t);const kt="abcdefghijklmnopqrstuvwxyz".split("");for(const t of kt)V[t]=m(t),V[t.toUpperCase()]=m(t,"⇧");const wt=[...Object.keys(Z),...Object.keys(x)];for(const t of wt)V[t]=m(t);const vt={1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","'":'"',"=":"+",";":":",",":"<",".":">","/":"?","-":"_","[":"{","\\":"|","]":"}","`":"~"};for(const[t,e]of Object.entries(vt))V[e]=m(t,"⇧");function qe(t,e){return t.split("").map(i=>{const o=(e==null?void 0:e[i])||V[i];if(!o)throw new Error(`${i} is unknown. Please provide a map with { ${i}: {ToEvent} }`);return o})}class L{constructor(e){this.manipulator={type:"basic",from:e}}get from(){return this.manipulator.from}to(e,i,o){return this.addToEvent(typeof e=="object"?e:m(e,i,o)),this}toHyper(e){return this.addToEvent(Me(e)),this}toMeh(e){return this.addToEvent(Ke(e)),this}toSuperHyper(e){return this.addToEvent(Ae(e)),this}toNone(e){return this.addToEvent(Se(e)),this}toConsumerKey(e,i,o){return this.addToEvent(Ee(e,i,o)),this}toPointingButton(e,i,o){return this.addToEvent(Te(e,i,o)),this}to$(e){return this.addToEvent(U(e)),this}toApp(e){return this.addToEvent(Oe(e)),this}toPaste(e){return this.addToEvent($e(e)),this}toInputSource(e){return this.addToEvent(je(e)),this}toVar(e,i=1,o,r){return this.addToEvent(h(e,i,o,r)),this}toUnsetVar(e){return this.addToEvent(De(e)),this}toNotificationMessage(e,i){return this.addToEvent(te(e,i)),this}toRemoveNotificationMessage(e){return this.addToEvent(F(e)),this}toMouseKey(e){return this.addToEvent(Ve(e)),this}toStickyModifier(e,i="toggle"){return this.addToEvent(Le(e,i)),this}toCgEventDoubleClick(e){return this.addToEvent(Ne(e)),this}toMouseCursorPosition(e){return this.addToEvent(Be(e)),this}toSleepSystem(e){return this.addToEvent(Ie(e)),this}toTypeSequence(e,i){return this.addToEvent(qe(e,i)),this}toIfAlone(e,i,o){return this.pushOrCreateList(this.manipulator,"to_if_alone",typeof e=="object"?e:m(e,i,o)),this}toIfHeldDown(e,i,o){return this.pushOrCreateList(this.manipulator,"to_if_held_down",typeof e=="object"?e:m(e,i,o)),this}toAfterKeyUp(e,i,o){return this.pushOrCreateList(this.manipulator,"to_after_key_up",typeof e=="object"?e:m(e,i,o)),this}toDelayedAction(e,i){const o=this.manipulator.to_delayed_action||{to_if_invoked:[],to_if_canceled:[]};return C(e).forEach(r=>o.to_if_invoked.push(r)),C(i).forEach(r=>o.to_if_canceled.push(r)),this.manipulator.to_delayed_action=o,this}description(e){return this.manipulator.description=e,this}condition(...e){const{conditions:i=[]}=this.manipulator;return this.manipulator.conditions=[...i,...e.map(E)],this}parameters(e){return this.manipulator.parameters={...this.manipulator.parameters,...e},this}build(e){return[{...this.manipulator}]}addToEvent(e){this.pushOrCreateList(this.manipulator,"to",e)}pushOrCreateList(e,i,o){const r=e[i]||[];C(o).forEach(s=>r.push(s)),Object.assign(e,{[i]:r})}}function Ct(t){return typeof t.build=="function"}function N(t,e){return Ct(t)?t.build(e):"type"in t?[t]:Object.entries(t).reduce((o,[r,s])=>[...o,...D(r).to(s).build(e)],[])}function Mt(...t){return e=>{const i=t.map(E);function o(a){return a.type!=="basic"?a:{...a,conditions:[...a.conditions||[],...i]}}const s=(Array.isArray(e)?e:N(e)).reduce((a,c)=>[...a,...N(c).map(o)],[]);return Object.assign(s,{build:()=>s})}}function Kt(t){return e=>({build:()=>(Array.isArray(t)?t.map((o,r)=>[o,r]):Object.entries(t)).reduce((o,[r,s])=>[...o,...N(e(r,s))],[])})}function At(t,e){return i=>({build:o=>{const r=b(t,e);return(Array.isArray(i)?i:N(i)).map(a=>N(a,o)).reduce((a,c)=>a.concat(c),[]).map(a=>{var l;const c=Object.keys(r).reduce((u,d)=>{var f;if(!((f=r[d])!=null&&f.length))return u;const y=new Set([...u[d]||[],...r[d]]);return u[d]=y.has("any")?["any"]:Array.from(y),u},{...(l=a.from)==null?void 0:l.modifiers});return a.from={...a.from,modifiers:c},a})}})}function Re(t,e,i){const o=s=>A(s,O,"for from.simultaneous"),r=new St({simultaneous:t.map(s=>typeof s=="object"?s:{key_code:o(s)}),simultaneous_options:e});return i&&r.parameters({"basic.simultaneous_threshold_milliseconds":i}),r}class St extends L{constructor(e){super(e)}modifiers(e,i){return this.manipulator.from.modifiers=e||i?b(e,i):void 0,this}}const ie={"double_tap.delay_milliseconds":200};function Et(t,e,i,o){const r=A(t,[...q,...O],"for double tap"),s=new Tt({key_code:r});return o?(s.delay(o),s.from.modifiers=b(e,i)):i?typeof i=="number"?(s.delay(i),s.from.modifiers=b(e)):s.from.modifiers=b(e,i):e&&(typeof e=="number"?s.delay(e):s.from.modifiers=b(e)),s}class Tt extends L{constructor(e){super(e),this.singleTapEvent=void 0}singleTap(e){return this.singleTapEvent=e,this}delay(e){return this.delayParam=e,this}build(e){var y;const i=(e==null?void 0:e.getParameters(ie))??ie,o=this.delayParam||i["double_tap.delay_milliseconds"],r=this.from.key_code;if(this.singleTapEvent===void 0){this.singleTapEvent={key_code:r};const f=(y=this.manipulator.from.modifiers)==null?void 0:y.mandatory;f&&(this.singleTapEvent.modifiers=f.filter(g=>g!=="any"))}const s=["double-tap",r];this.from.modifiers&&[this.from.modifiers.mandatory,this.from.modifiers.optional].map(f=>f!=null&&f.length?f.join(","):"").forEach(f=>f&&s.push(f));const a=s.join("-"),c=k(a).build(),l=k(a).unless().build(),u={...this.manipulator,conditions:[...this.manipulator.conditions||[],c]},d={...this.manipulator,to:[h(a,1)],conditions:[l],to_delayed_action:{to_if_invoked:[...this.singleTapEvent?[this.singleTapEvent]:[],h(a,0)],to_if_canceled:[h(a,0)]}};return d.parameters={"basic.to_delayed_action_delay_milliseconds":o},[u,d]}}function Ot(){return new $t}class $t{constructor(){this.manipulator={type:"mouse_motion_to_scroll"}}modifiers(e,i){return this.manipulator.from={modifiers:b(e,i)},this}condition(...e){const{conditions:i=[]}=this.manipulator;return this.manipulator.conditions=[...i,...e.map(E)],this}options(e){return this.manipulator.options={...this.manipulator.options,...e},this}build(e){return[{...this.manipulator}]}}function Pt(t,...e){return new G(t,...e)}class G{constructor(e,...i){this.ruleDescription=e,this.manipulatorSources=[],this.allowEmptyManipulators=!1,this.conditions=i}manipulators(e){return Array.isArray(e)?e.forEach(i=>this.manipulatorSources.push(i)):this.manipulatorSources.push(e),this}condition(...e){return e.forEach(i=>this.conditions.push(i)),this}description(e){return this.ruleDescription=e,this}build(e){const i={description:this.ruleDescription,manipulators:this.manipulatorSources.reduce((r,s)=>[...r,...N(s,e)],[])};if(!this.allowEmptyManipulators&&i.manipulators.length===0)throw new Error(`"manipulators" is empty in "${i.description}"`);if(this.conditions.length===0)return i;const o=this.conditions.map(E);return i.manipulators=i.manipulators.map(r=>r.type==="basic"?{...r,conditions:[...r.conditions||[],...o]}:{...r}),i}}function jt(t){return typeof t.build=="function"}function Dt(t,e){return jt(t)?t.build(e):t}const Q={escape:["escape","caps_lock"]};function Ue(t,e,i){const o=[];if(!t)return o;for(const r of Array.isArray(t)?t:[t]){const s=D(r);o.push(...s.condition(e).to(i).build())}return o}const oe=[...O,...q,...K];function Fe(t,e,i=1,o=0){return new Lt(t,e,i,o)}function He(t,e,i,o=1,r=0){return Fe(e,i,o,r).modifiers(t)}function Vt(t,e,i=1,o=0){return He("Hyper",t,e,i,o)}class Lt extends G{constructor(e,i,o=1,r=0){const s=C(e).map(a=>A(a,oe,"as layer key"));i||(i=`layer-${s.join("-")}`),super(`Layer - ${i}`),this.onValue=o,this.offValue=r,this.replaceLayerKeyToIfAlone=!1,this.keys=s,this.varName=i,this.layerCondition=k(this.varName,this.onValue),this.condition(this.layerCondition),this.allowEmptyManipulators=!0}modifiers(e,i){return this.layerModifiers=e||i?b(e,i):void 0,this}configKey(e,i=!1){return this.layerKeyManipulator||(this.layerKeyManipulator=D("fn")),e(this.layerKeyManipulator),this.replaceLayerKeyToIfAlone=i,this}notification(e=!0){return this.layerNotification=e,this}leaderMode(e=!0){return e===!0?this.leaderModeOptions=Q:e?this.leaderModeOptions={...Q,...e}:this.leaderModeOptions=void 0,this}build(e){var r,s,a,c;const i=super.build(e);if(this.leaderModeOptions){const l=[h(this.varName,this.offValue)];this.layerNotification&&l.push(F(ze(this.varName))),this.leaderModeOptions.sticky||i.manipulators.forEach(u=>u.type==="basic"&&(u.to=(u.to||[]).concat(l))),i.manipulators.push(...Ue(this.leaderModeOptions.escape,k(this.varName,this.onValue),l))}if((s=(r=this.layerModifiers)==null?void 0:r.mandatory)!=null&&s.length||(c=(a=this.layerModifiers)==null?void 0:a.optional)!=null&&c.length){const l=We(this.layerModifiers)==="optional";i.manipulators.forEach(u=>this.addModifierAnyToManipulator(u,l))}const o=this.conditions.filter(l=>l!==this.layerCondition).map(E);for(const l of this.keys)i.manipulators=[...Je(l,this.varName,this.onValue,this.offValue,this.layerModifiers,o,e,this.layerKeyManipulator,this.replaceLayerKeyToIfAlone,this.layerNotification===!0?this.ruleDescription:this.layerNotification||void 0,this.leaderModeOptions),...i.manipulators];return i}addModifierAnyToManipulator(e,i){if(e.type==="basic"){if(e.from.modifiers){const{mandatory:o,optional:r}=e.from.modifiers;if(r!=null&&r.length||o!=null&&o.length){const s=We(e.from.modifiers);if(s==="mandatory")e.from.modifiers={mandatory:["any"]};else if(s==="optional")e.from.modifiers={optional:["any"]};else throw new Error("Layers with modifiers cannot have modifiers on manipulators");return}}e.from.modifiers=i?{optional:["any"]}:{mandatory:["any"]}}}}function Je(t,e,i,o,r,s,a,c,l,u,d){var _;function y(p){var Xe;if(!c)return p;const I=c.build()[0],T=C(p)[0];if(["to","to_if_alone","to_if_held_down","to_after_key_up"].forEach(M=>{var X;return(X=I[M])==null?void 0:X.forEach(Y=>T[M]=[...T[M]||[],Y])}),I.to_delayed_action){T.to_delayed_action=T.to_delayed_action||{to_if_invoked:[],to_if_canceled:[]};for(const M of["to_if_invoked","to_if_canceled"])I.to_delayed_action[M].forEach(X=>{var Y;return(Y=T.to_delayed_action)==null?void 0:Y[M].push(X)})}return l&&(T.to_if_alone=(Xe=T.to_if_alone)==null?void 0:Xe.filter(M=>!("key_code"in M&&M.key_code===t))),p}const f="__layer",g=D({key_code:t,modifiers:r}).toVar(e,i).toVar(f).condition(k(e,i).unless(),k(f).unless());if(!((_=r==null?void 0:r.mandatory)!=null&&_.length)&&!d&&g.toIfAlone({key_code:t}),d||g.toAfterKeyUp(h(e,o)).toAfterKeyUp(h(f,0)),s!=null&&s.length&&g.condition(...s),u){const p=ze(e);g.toNotificationMessage(p,u),d||g.toAfterKeyUp(F(p))}if(!a)return y(g.build());const H=[`layer_${t}`,...r?[JSON.stringify(r)]:[],...(s||[]).map(p=>JSON.stringify(p)).sort()].join("_"),v=a.getCache(H);if(v!=null&&v.to&&v.to_after_key_up)return v.to.find(I=>"set_variable"in I&&I.set_variable.name===e)||(v.to.push(h(e,i)),v.to_after_key_up.push(h(e,o))),y(v),[];const J=g.build(a);return a.setCache(H,J[0]),y(J)}function We({mandatory:t,optional:e}){return(t==null?void 0:t.length)===1&&t[0]==="any"?"mandatory":(e==null?void 0:e.length)===1&&e[0]==="any"?"optional":null}function ze(t){return`layer-${t}`}const ne={"simlayer.threshold_milliseconds":200};function Nt(t,e,i,o=1,r=0){return new Bt(t,e,i,o,r)}class Bt extends G{constructor(e,i,o,r=1,s=0){const a=C(e).map(c=>A(c,oe,"as simlayer key"));i||(i=`simlayer-${a.join("-")}`),super(`Simlayer - ${i}`),this.threshold=o,this.onValue=r,this.offValue=s,this.sharedLayerKeys=[],this.simultaneousOptions={detect_key_down_uninterruptedly:!0,key_down_order:"strict",key_up_order:"strict_inverse",key_up_when:"any"},this.layerModifiers={optional:["any"]},this.ifActivated=[],this.ifDeactivated=[],this.keys=a,this.varName=i,this.layerCondition=k(this.varName,this.onValue),this.condition(this.layerCondition)}modifiers(e,i){return this.layerModifiers=e||i?b(e,i):void 0,this}options(e){return Object.assign(this.simultaneousOptions,e),this}enableLayer(...e){return e.map(i=>A(i,oe,"as layer key")).forEach(i=>{if(this.keys.includes(i))throw new Error(`Key ${i} is already used in ${this.ruleDescription}`);if(this.sharedLayerKeys.includes(i))throw new Error(`Key ${i} is already used as shared layer key in  ${this.ruleDescription}`);this.sharedLayerKeys.push(i)}),this}toIfActivated(e){return this.ifActivated.push(e),this}toIfDeactivated(e){return this.ifDeactivated.push(e),this}build(e){const i=super.build(e),o=(e==null?void 0:e.getParameters(ne))??ne,r=this.threshold||o["simlayer.threshold_milliseconds"],s=this.conditions.length>1?this.conditions.filter(l=>l!==this.layerCondition).map(E):void 0,a=h(this.varName,this.onValue),c=h(this.varName,this.offValue);i.manipulators.concat().forEach(l=>{var d;if(l.type!=="basic")throw new Error(`Unsupported manipulator type ${l.type} in simlayer ${this.ruleDescription}`);const u=(d=l.from)==null?void 0:d.key_code;if(!u)throw new Error(`Missing from.key_code in simlayer ${this.ruleDescription}`);this.layerModifiers&&(l.from.modifiers={...l.from.modifiers,...this.layerModifiers});for(const y of this.keys)i.manipulators.push({type:"basic",parameters:{"basic.simultaneous_threshold_milliseconds":r},to:[a,...l.to||[],...this.ifActivated],from:{simultaneous:[{key_code:y},{key_code:u}],simultaneous_options:{...this.simultaneousOptions,to_after_key_up:[...this.simultaneousOptions.to_after_key_up||[],c,...this.ifDeactivated]},modifiers:this.layerModifiers},conditions:s})});for(const l of this.sharedLayerKeys)i.manipulators=[...Je(l,this.varName,this.onValue,this.offValue,this.layerModifiers,s,e),...i.manipulators];return i}}const re={"duo_layer.threshold_milliseconds":200,"duo_layer.notification":!1};function It(t,e,i,o=1,r=0){return new qt(t,e,i,o,r)}class qt extends G{constructor(e,i,o,r=1,s=0){const a=`DuoLayer ${o||`${e} ${i}`}`;o||(o=`duo-layer-${e}-${i}`),super(a),this.key1=e,this.key2=i,this.onValue=r,this.offValue=s,this.simultaneousOptions={},this.ifActivated=[],this.ifDeactivated=[],this.varName=o,this.layerCondition=k(this.varName,this.onValue),this.condition(this.layerCondition),this.allowEmptyManipulators=!0}threshold(e){return this.simultaneousThreshold=e,this}options(e){return Object.assign(this.simultaneousOptions,e),this}notification(e=!0){return this.layerNotification=e,this}toIfActivated(e){return this.ifActivated.push(e),this}toIfDeactivated(e){return this.ifDeactivated.push(e),this}leaderMode(e=!0){return e===!0?this.leaderModeOptions=Q:e?this.leaderModeOptions={...Q,...e}:this.leaderModeOptions=void 0,this}build(e){var g,H,v,J;const i=super.build(e),o=(e==null?void 0:e.getParameters(re))??re,r=this.simultaneousThreshold||o["duo_layer.threshold_milliseconds"],s=this.layerNotification??o["duo_layer.notification"],a=this.conditions.filter(_=>_!==this.layerCondition).map(E),c=[h(this.varName,this.onValue),...this.ifActivated],l=[h(this.varName,this.offValue),...this.ifDeactivated];if(s){const _=`duo-layer-${this.varName}`,p=s===!0?this.ruleDescription:s;c.push(te(_,p)),l.push(F(_))}this.leaderModeOptions&&(this.leaderModeOptions.sticky||i.manipulators.forEach(_=>_.type==="basic"&&(_.to=(_.to||[]).concat(l))),i.manipulators.push(...Ue(this.leaderModeOptions.escape,k(this.varName,this.onValue),l)));const u=this.simultaneousOptions.to_after_key_up||[];this.leaderModeOptions||u.push(...l);const d=Re([this.key1,this.key2],{...this.simultaneousOptions,to_after_key_up:u},r).modifiers("??").to(c).condition(k(this.varName,this.onValue).unless());if(a.length&&d.condition(...a),!e)return i.manipulators=[...d.build(),...i.manipulators],i;const y=[`duo_layer_${this.key1}_${this.key2}`,...a.map(_=>JSON.stringify(_)).sort()].join("_"),f=e.getCache(y);if(f)((g=f.to)==null?void 0:g.find(p=>"set_variable"in p&&p.set_variable.name===this.varName))||((H=f.to)==null||H.push(h(this.varName,this.onValue)),(J=(v=f.from.simultaneous_options)==null?void 0:v.to_after_key_up)==null||J.push(h(this.varName,this.offValue)));else{const _=d.build(e)[0];e.setCache(y,_),i.manipulators=[_,...i.manipulators]}return i}}class Rt{constructor(){this.parameters={},this.cache=new Map}setParameters(e){Object.assign(this.parameters,e)}getParameters(e){const i={...e};for(const o of Object.keys(e))o in this.parameters&&this.parameters[o]!==void 0&&Object.assign(i,{[o]:this.parameters[o]});return i}getCache(e){return this.cache.get(e)}setCache(e,i){this.cache.set(e,i)}}const Ge={"basic.to_if_alone_timeout_milliseconds":1e3,"basic.to_if_held_down_threshold_milliseconds":500,"basic.to_delayed_action_delay_milliseconds":500,"basic.simultaneous_threshold_milliseconds":50,"mouse_motion_to_scroll.speed":100};function Qe(t,e={}){const{"double_tap.delay_milliseconds":i,"simlayer.threshold_milliseconds":o,"duo_layer.threshold_milliseconds":r,"duo_layer.notification":s,...a}=e,c=new Rt;c.setParameters({"double_tap.delay_milliseconds":i}),c.setParameters({"simlayer.threshold_milliseconds":o}),c.setParameters({"duo_layer.threshold_milliseconds":r,"duo_layer.notification":s});const l=t.map(d=>Dt(d,c)),u={rules:l.filter(d=>d.manipulators.length),parameters:{...Ge,...a}};if(u.rules.length===0)throw new Error('complex_modifications "rules" is empty ');return u.rules.length<l.length&&console.warn(`Rules with empty manipulators are ignored: 
${l.filter(d=>d.manipulators.length===0).map(d=>"- "+d.description).join(`
`)}
`),u}const B={karabinerConfigDir(){return require("node:path").join(require("node:os").homedir(),".config/karabiner")},karabinerConfigFile(){return require("node:path").join(this.karabinerConfigDir(),"karabiner.json")},readKarabinerConfig(t){return require(t??this.karabinerConfigFile())},writeKarabinerConfig(t,e){return require("node:fs/promises").writeFile(e??this.karabinerConfigFile(),t)},readJson(t){return require(t)},exit(t=0){process.exit(t)}};function Ut(t,e,i={}){typeof t=="string"&&(t={name:t,dryRun:t==="--dry-run"});const{name:o,dryRun:r}=t,s=t.karabinerJsonPath??B.karabinerConfigFile(),a=r?{profiles:[{name:o,complex_modifications:{rules:[]}}]}:B.readKarabinerConfig(s),c=a==null?void 0:a.profiles.find(u=>u.name===o);c||se(`⚠️ Profile ${o} not found in ${s}.

ℹ️ Please check the profile name in the Karabiner-Elements UI and 
    - Update the profile name at writeToProfile()
    - Create a new profile if needed
 `);try{c.complex_modifications=Qe(e,i)}catch(u){se(u)}const l=JSON.stringify(a,null,2);if(r){console.info(l);return}B.writeKarabinerConfig(l,s).catch(se),console.log(`✓ Profile ${o} updated.`)}function se(t){return t&&console.error(typeof t=="string"?t:t.message||t),B.exit(1)}function Ft(t){return{build(){const e=B.readJson(t);if(!Array.isArray(e==null?void 0:e.rules))throw new Error(`Cannot file rules in ${t}`);return{description:`Imported from ${t}`,manipulators:e.rules.reduce((i,o)=>i.concat(o.manipulators),[])}}}}function Ht(t,e){return{build(){const o=B.readKarabinerConfig(e).profiles.find(r=>r.name===t);if(!o)throw new Error(`Profile ${t} not found`);return{description:`Imported from profile ${t}`,manipulators:o.complex_modifications.rules.reduce((r,s)=>r.concat(s.manipulators),[])}}}}n.ConditionBuilder=w,n.arrowKeyAliases=Z,n.arrowKeyCodes=ue,n.buildCondition=E,n.complexModifications=Qe,n.controlOrSymbolKeyAliases=x,n.controlOrSymbolKeyCodes=le,n.defaultComplexModificationsParameters=Ge,n.defaultDoubleTapParameters=ie,n.defaultDuoLayerParameters=re,n.defaultSimlayerParameters=ne,n.duoLayer=It,n.fromAndToConsumerKeyCodes=Ye,n.fromOnlyConsumerKeyCodes=Ze,n.fromOnlyKeyCodes=q,n.functionKeyCodes=fe,n.getKeyWithAlias=A,n.hyperLayer=Vt,n.ifApp=st,n.ifDevice=at,n.ifDeviceExists=lt,n.ifEventChanged=dt,n.ifInputSource=ct,n.ifKeyboardType=ut,n.ifVar=k,n.importJson=Ft,n.importProfile=Ht,n.internationalKeyCodes=pe,n.isConditionBuilder=Ce,n.isSideMultiModifierAlias=R,n.japaneseKeyCodes=me,n.keypadKeyCodes=_e,n.layer=Fe,n.letterKeyCodes=ce,n.map=D,n.mapConsumerKey=yt,n.mapDoubleTap=Et,n.mapPointingButton=bt,n.mapSimultaneous=Re,n.modifierKeyAliases=$,n.modifierKeyCodes=ae,n.modifierLayer=He,n.mouseMotionToScroll=Ot,n.multiModifierAliases=ee,n.namedMultiModifierAliases=ge,n.numberKeyCodes=de,n.otherKeyCodes=ye,n.parseFromModifierParams=P,n.parseModifierParam=S,n.parseSideMultiModifierAlias=W,n.pcKeyboardKeyCodes=he,n.pointingButtons=et,n.rule=Pt,n.simlayer=Nt,n.stickyModifierKeyCodes=K,n.systemSounds=Pe,n.to$=U,n.toApp=Oe,n.toCgEventDoubleClick=Ne,n.toConsumerKey=Ee,n.toHyper=Me,n.toInputSource=je,n.toKey=m,n.toMeh=Ke,n.toMouseCursorPosition=Be,n.toMouseKey=Ve,n.toNone=Se,n.toNotificationMessage=te,n.toOnlyConsumerKeyCodes=xe,n.toOnlyKeyCodes=O,n.toPaste=$e,n.toPlaySound=gt,n.toPointingButton=Te,n.toRemoveNotificationMessage=F,n.toSetVar=h,n.toSleepSystem=Ie,n.toStickyModifier=Le,n.toSuperHyper=Ae,n.toTypeSequence=qe,n.toUnsetVar=De,n.withCondition=Mt,n.withMapper=Kt,n.withModifier=At,n.writeToProfile=Ut,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
